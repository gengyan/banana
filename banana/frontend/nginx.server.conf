# æœåŠ¡å™¨ç«¯ Nginx é…ç½®æ–‡ä»¶ç¤ºä¾‹
# ç”¨äºéƒ¨ç½²åˆ°è‡ªå®šä¹‰æœåŠ¡å™¨ï¼ˆå¦‚ root@120.55.181.23ï¼‰
# 
# ä½¿ç”¨æ–¹æ³•ï¼š
# 1. å°†æ­¤æ–‡ä»¶å¤åˆ¶åˆ°æœåŠ¡å™¨ï¼š/etc/nginx/conf.d/guojie.conf æˆ– /etc/nginx/sites-available/guojie
# 2. ç¡®ä¿ server_name åŒ¹é…ä½ çš„åŸŸå
# 3. root è·¯å¾„æŒ‡å‘å®é™…éƒ¨ç½²ç›®å½•
# 4. é‡å¯ Nginxï¼šsudo nginx -t && sudo systemctl reload nginx

server {
    listen 80;
    # å¦‚æœéœ€è¦ HTTPSï¼Œå¯ä»¥æ·»åŠ ï¼š
    # listen 443 ssl http2;
    # ssl_certificate /path/to/cert.pem;
    # ssl_certificate_key /path/to/key.pem;

    server_name gj.emaos.top;

    # éƒ¨ç½²ç›®å½•ï¼ˆæ ¹æ®å®é™…éƒ¨ç½²è·¯å¾„è°ƒæ•´ï¼‰
    root /data/wwwroot/default/guojie;
    index index.html;

    # æ—¥å¿—æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
    access_log /var/log/nginx/guojie_access.log;
    error_log /var/log/nginx/guojie_error.log;

    # Gzip å‹ç¼©
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types text/plain text/css text/xml text/javascript application/x-javascript application/xml+rss application/json application/javascript;

    # æ ¸å¿ƒé…ç½®ï¼šå¯¹ index.html å¼ºåˆ¶ä¸ç¼“å­˜
    location = /index.html {
        add_header Cache-Control "no-cache, no-store, must-revalidate";
        expires off;
    }

    # é™æ€èµ„æºï¼ˆCSS, JS, å›¾ç‰‡ç­‰ï¼‰è®¾ç½®é•¿æœŸç¼“å­˜
    # å› ä¸ºå®ƒä»¬çš„æ–‡ä»¶åå¸¦æœ‰å“ˆå¸ŒæŒ‡çº¹ï¼Œå†…å®¹å˜åŒ–æ—¶æ–‡ä»¶åä¹Ÿä¼šå˜åŒ–
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff2|woff|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, max-age=31536000, immutable";
        access_log off;
    }

    # ğŸ”¥ å…³é”®é…ç½®ï¼šSPA è·¯ç”±æ”¯æŒ
    # æ‰€æœ‰è·¯ç”±éƒ½å›é€€åˆ° index.htmlï¼Œè®©å‰ç«¯è·¯ç”±å¤„ç†
    location / {
        try_files $uri $uri/ /index.html;
        
        # å¯é€‰ï¼šæ·»åŠ å®‰å…¨å¤´
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header X-XSS-Protection "1; mode=block" always;
    }

    # å¥åº·æ£€æŸ¥ç«¯ç‚¹ï¼ˆå¯é€‰ï¼‰
    location /health {
        access_log off;
        return 200 "healthy\n";
        add_header Content-Type text/plain;
    }

    # ç¦æ­¢è®¿é—®éšè—æ–‡ä»¶
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
}
