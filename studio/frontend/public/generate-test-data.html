<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç”Ÿæˆæµ‹è¯•æ•°æ® - å†å²ä¼šè¯</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .container {
      background: rgba(255, 255, 255, 0.95);
      border-radius: 20px;
      padding: 40px;
      max-width: 600px;
      width: 100%;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    }
    h1 {
      color: #333;
      margin-bottom: 10px;
      font-size: 28px;
    }
    .subtitle {
      color: #666;
      margin-bottom: 30px;
      font-size: 14px;
    }
    .info {
      background: #f0f0f0;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 20px;
      font-size: 14px;
      color: #555;
    }
    .info strong {
      color: #333;
    }
    button {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s, box-shadow 0.2s;
      margin-bottom: 10px;
    }
    button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    button:active {
      transform: translateY(0);
    }
    button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }
    .progress {
      margin-top: 20px;
      display: none;
    }
    .progress.active {
      display: block;
    }
    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      width: 0%;
      transition: width 0.3s;
    }
    .progress-text {
      text-align: center;
      color: #666;
      font-size: 14px;
    }
    .log {
      margin-top: 20px;
      max-height: 300px;
      overflow-y: auto;
      background: #f9f9f9;
      border-radius: 10px;
      padding: 15px;
      font-family: 'Courier New', monospace;
      font-size: 12px;
      line-height: 1.6;
    }
    .log-item {
      margin-bottom: 5px;
      padding: 5px;
      border-radius: 4px;
    }
    .log-item.success {
      color: #28a745;
    }
    .log-item.error {
      color: #dc3545;
    }
    .log-item.info {
      color: #17a2b8;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ§ª ç”Ÿæˆæµ‹è¯•æ•°æ®</h1>
    <p class="subtitle">ä¸ºå†å²ä¼šè¯ç”Ÿæˆ 50 æ¡æµ‹è¯•æ•°æ®</p>
    
    <div class="info">
      <strong>è¯´æ˜ï¼š</strong><br>
      â€¢ å°†ç”Ÿæˆ 50 ä¸ªé¡¹ç›®ï¼Œæ¯ä¸ªé¡¹ç›®åŒ…å« 2-4 æ¡æ¶ˆæ¯<br>
      â€¢ ä½¿ç”¨ "æˆªå±2026-01-21 12.34.17.png" ä½œä¸ºå›¾ç‰‡æ•°æ®<br>
      â€¢ æ•°æ®å°†ä¿å­˜åˆ° IndexedDB (GuojieChatData)<br>
      â€¢ ç”Ÿæˆå®Œæˆåå¯åœ¨é¡¹ç›®åº“ä¸­æŸ¥çœ‹
    </div>

    <button id="generateBtn" onclick="generateTestData()">å¼€å§‹ç”Ÿæˆæµ‹è¯•æ•°æ®</button>
    <button id="clearBtn" onclick="clearAllData()" style="background: #dc3545;">æ¸…ç©ºæ‰€æœ‰æ•°æ®</button>

    <div class="progress" id="progress">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
      <div class="progress-text" id="progressText">å‡†å¤‡ä¸­...</div>
    </div>

    <div class="log" id="log"></div>
  </div>

  <script type="module">
    // åŠ¨æ€å¯¼å…¥å­˜å‚¨å‡½æ•°
    let storageFunctions = null;

    async function loadStorageFunctions() {
      if (storageFunctions) return storageFunctions;
      
      try {
        const module = await import('/src/utils/storage.js');
        storageFunctions = {
          createProject: module.createProject,
          saveMessage: module.saveMessage,
          getAllProjects: module.getAllProjects,
          clearAllHistory: module.clearAllHistory
        };
        return storageFunctions;
      } catch (error) {
        console.error('åŠ è½½å­˜å‚¨å‡½æ•°å¤±è´¥:', error);
        throw new Error('æ— æ³•åŠ è½½å­˜å‚¨å‡½æ•°ï¼Œè¯·ç¡®ä¿åœ¨æ­£ç¡®çš„ç¯å¢ƒä¸­è¿è¡Œï¼ˆhttp://localhost:3000ï¼‰');
      }
    }

    // æ—¥å¿—å‡½æ•°
    function log(message, type = 'info') {
      const logDiv = document.getElementById('log');
      const item = document.createElement('div');
      item.className = `log-item ${type}`;
      item.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
      logDiv.appendChild(item);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(message);
    }

    // æ›´æ–°è¿›åº¦
    function updateProgress(current, total, message) {
      const progress = document.getElementById('progress');
      const progressFill = document.getElementById('progressFill');
      const progressText = document.getElementById('progressText');
      
      progress.classList.add('active');
      const percentage = Math.round((current / total) * 100);
      progressFill.style.width = `${percentage}%`;
      progressText.textContent = `${message} (${current}/${total})`;
    }

    // åŠ è½½å›¾ç‰‡å¹¶è½¬æ¢ä¸º base64
    async function loadImageAsBase64(imagePath) {
      try {
        const response = await fetch(imagePath);
        if (!response.ok) {
          throw new Error(`æ— æ³•åŠ è½½å›¾ç‰‡: ${response.statusText}`);
        }
        const blob = await response.blob();
        return new Promise((resolve, reject) => {
          const reader = new FileReader();
          reader.onloadend = () => resolve(reader.result);
          reader.onerror = reject;
          reader.readAsDataURL(blob);
        });
      } catch (error) {
        log(`âŒ åŠ è½½å›¾ç‰‡å¤±è´¥: ${error.message}ï¼Œä½¿ç”¨å ä½ç¬¦`, 'error');
        // å¦‚æœå›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œè¿”å›ä¸€ä¸ªå ä½ç¬¦
        return 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAADUlEQVR42mNk+M9QDwADhgGAWjR9awAAAABJRU5ErkJggg==';
      }
    }

    // ç”Ÿæˆéšæœºæç¤ºè¯
    function generateRandomPrompt(index) {
      const prompts = [
        'ç”Ÿæˆä¸€å¼ ç¾ä¸½çš„é£æ™¯ç”»',
        'åˆ›å»ºä¸€ä¸ªæœªæ¥åŸå¸‚çš„åœºæ™¯',
        'ç”»ä¸€åªå¯çˆ±çš„å°çŒ«',
        'è®¾è®¡ä¸€ä¸ªç°ä»£é£æ ¼çš„å»ºç­‘',
        'ç”Ÿæˆä¸€å¼ æŠ½è±¡è‰ºæœ¯ç”»',
        'åˆ›å»ºä¸€ä¸ªç§‘å¹»åœºæ™¯',
        'ç”»ä¸€å¹…æ°´å½©ç”»é£æ ¼çš„ä½œå“',
        'è®¾è®¡ä¸€ä¸ªæç®€é£æ ¼çš„å›¾æ ‡',
        'ç”Ÿæˆä¸€å¼ æ—¥å¼é£æ ¼çš„æ’ç”»',
        'åˆ›å»ºä¸€ä¸ª3Dæ¸²æŸ“åœºæ™¯',
        'ç”»ä¸€å¹…å°è±¡æ´¾é£æ ¼çš„ç”»ä½œ',
        'è®¾è®¡ä¸€ä¸ªå¤å¤é£æ ¼çš„æµ·æŠ¥',
        'ç”Ÿæˆä¸€å¼ è¶…ç°å®ä¸»ä¹‰ä½œå“',
        'åˆ›å»ºä¸€ä¸ªå¡é€šé£æ ¼çš„è§’è‰²',
        'ç”»ä¸€å¹…å†™å®é£æ ¼çš„è‚–åƒ',
        'è®¾è®¡ä¸€ä¸ªç°ä»£UIç•Œé¢',
        'ç”Ÿæˆä¸€å¼ æ¦‚å¿µè‰ºæœ¯å›¾',
        'åˆ›å»ºä¸€ä¸ªå¥‡å¹»ä¸–ç•Œçš„åœºæ™¯',
        'ç”»ä¸€å¹…ä¸­å›½é£çš„æ°´å¢¨ç”»',
        'è®¾è®¡ä¸€ä¸ªç§‘æŠ€æ„Ÿçš„äº§å“å›¾',
        'ç”Ÿæˆä¸€å¼ å¤œæ™¯ç…§ç‰‡',
        'åˆ›å»ºä¸€ä¸ªæµ·åº•ä¸–ç•Œçš„åœºæ™¯',
        'ç”»ä¸€å¹…æ²¹ç”»é£æ ¼çš„ä½œå“',
        'è®¾è®¡ä¸€ä¸ªæç®€é£æ ¼çš„logo',
        'ç”Ÿæˆä¸€å¼ åŠ¨æ¼«é£æ ¼çš„æ’ç”»',
        'åˆ›å»ºä¸€ä¸ªå¤–å¤ªç©ºçš„åœºæ™¯',
        'ç”»ä¸€å¹…ç´ æé£æ ¼çš„ä½œå“',
        'è®¾è®¡ä¸€ä¸ªç°ä»£é£æ ¼çš„åŒ…è£…',
        'ç”Ÿæˆä¸€å¼ èµ›åšæœ‹å…‹é£æ ¼çš„ä½œå“',
        'åˆ›å»ºä¸€ä¸ªç«¥è¯ä¸–ç•Œçš„åœºæ™¯',
        'ç”»ä¸€å¹…å·¥ç¬”ç”»é£æ ¼çš„ä½œå“',
        'è®¾è®¡ä¸€ä¸ªæ‰å¹³åŒ–é£æ ¼çš„å›¾æ ‡',
        'ç”Ÿæˆä¸€å¼ è’¸æ±½æœ‹å…‹é£æ ¼çš„ä½œå“',
        'åˆ›å»ºä¸€ä¸ªé­”æ³•ä¸–ç•Œçš„åœºæ™¯',
        'ç”»ä¸€å¹…ç‰ˆç”»é£æ ¼çš„ä½œå“',
        'è®¾è®¡ä¸€ä¸ªç°ä»£é£æ ¼çš„ç½‘ç«™',
        'ç”Ÿæˆä¸€å¼ è¶…å†™å®é£æ ¼çš„ä½œå“',
        'åˆ›å»ºä¸€ä¸ªæœ«æ—¥ä¸–ç•Œçš„åœºæ™¯',
        'ç”»ä¸€å¹…æ¼«ç”»é£æ ¼çš„ä½œå“',
        'è®¾è®¡ä¸€ä¸ªç°ä»£é£æ ¼çš„appç•Œé¢',
        'ç”Ÿæˆä¸€å¼ åƒç´ è‰ºæœ¯é£æ ¼çš„ä½œå“',
        'åˆ›å»ºä¸€ä¸ªå¤ä»£ä¸–ç•Œçš„åœºæ™¯',
        'ç”»ä¸€å¹…æ’ç”»é£æ ¼çš„ä½œå“',
        'è®¾è®¡ä¸€ä¸ªç°ä»£é£æ ¼çš„å“ç‰Œ',
        'ç”Ÿæˆä¸€å¼ æ•°å­—è‰ºæœ¯é£æ ¼çš„ä½œå“',
        'åˆ›å»ºä¸€ä¸ªæœªæ¥ä¸–ç•Œçš„åœºæ™¯',
        'ç”»ä¸€å¹…æ‰‹ç»˜é£æ ¼çš„ä½œå“',
        'è®¾è®¡ä¸€ä¸ªç°ä»£é£æ ¼çš„å¡ç‰‡',
        'ç”Ÿæˆä¸€å¼ æŠ½è±¡è¡¨ç°ä¸»ä¹‰ä½œå“',
        'åˆ›å»ºä¸€ä¸ªç¥ç§˜ä¸–ç•Œçš„åœºæ™¯'
      ];
      return prompts[index % prompts.length];
    }

    // ç”Ÿæˆéšæœºå›å¤
    function generateRandomResponse(index) {
      const responses = [
        'å¥½çš„ï¼Œæˆ‘æ¥ä¸ºæ‚¨ç”Ÿæˆè¿™å¼ å›¾ç‰‡ã€‚è¿™å°†æ˜¯ä¸€å¹…ç²¾ç¾çš„ä½œå“ï¼Œå±•ç°æ‚¨æ‰€æè¿°çš„åœºæ™¯ã€‚',
        'æ­£åœ¨ä¸ºæ‚¨åˆ›å»ºå›¾ç‰‡ï¼Œè¯·ç¨å€™...',
        'å›¾ç‰‡ç”Ÿæˆä¸­ï¼Œè¿™å¯èƒ½éœ€è¦å‡ ç§’é’Ÿæ—¶é—´ã€‚',
        'å¥½çš„ï¼Œæˆ‘å·²ç»ç†è§£äº†æ‚¨çš„éœ€æ±‚ï¼Œæ­£åœ¨ç”Ÿæˆç›¸åº”çš„å›¾ç‰‡ã€‚',
        'æ­£åœ¨å¤„ç†æ‚¨çš„è¯·æ±‚ï¼Œå›¾ç‰‡å³å°†ç”Ÿæˆå®Œæˆã€‚',
        'å›¾ç‰‡ç”Ÿæˆå®Œæˆï¼è¿™æ˜¯ä¸€å¹…ç²¾ç¾çš„ä½œå“ï¼Œå±•ç°äº†æ‚¨æ‰€æè¿°çš„åœºæ™¯ã€‚',
        'å·²ç»ä¸ºæ‚¨åˆ›å»ºäº†å›¾ç‰‡ï¼Œå¸Œæœ›æ‚¨å–œæ¬¢è¿™ä¸ªç»“æœã€‚',
        'å›¾ç‰‡å·²ç”Ÿæˆï¼Œè¿™æ˜¯ä¸€å¹…é«˜è´¨é‡çš„ä½œå“ã€‚',
        'å®Œæˆäº†ï¼å›¾ç‰‡å·²ç»ç”Ÿæˆï¼Œå±•ç°äº†æ‚¨è¦æ±‚çš„é£æ ¼å’Œå†…å®¹ã€‚',
        'å›¾ç‰‡ç”ŸæˆæˆåŠŸï¼Œè¿™æ˜¯ä¸€å¹…ä»¤äººæ»¡æ„çš„ä½œå“ã€‚'
      ];
      return responses[index % responses.length];
    }

    // ç”Ÿæˆæµ‹è¯•æ•°æ®
    window.generateTestData = async function() {
      const btn = document.getElementById('generateBtn');
      const logDiv = document.getElementById('log');
      logDiv.innerHTML = '';
      
      try {
        btn.disabled = true;
        log('ğŸš€ å¼€å§‹ç”Ÿæˆæµ‹è¯•æ•°æ®...', 'info');
        
        // åŠ è½½å­˜å‚¨å‡½æ•°
        log('ğŸ“¦ æ­£åœ¨åŠ è½½å­˜å‚¨å‡½æ•°...', 'info');
        const storage = await loadStorageFunctions();
        log('âœ… å­˜å‚¨å‡½æ•°åŠ è½½æˆåŠŸ', 'success');
        
        // åŠ è½½å›¾ç‰‡
        log('ğŸ“¸ æ­£åœ¨åŠ è½½å›¾ç‰‡...', 'info');
        const imageData = await loadImageAsBase64('/æˆªå±2026-01-21 12.34.17.png');
        log(`âœ… å›¾ç‰‡åŠ è½½æˆåŠŸï¼Œå¤§å°: ${(imageData.length / 1024).toFixed(2)} KB`, 'success');
        
        const totalProjects = 50;
        let successCount = 0;
        let errorCount = 0;
        
        for (let i = 0; i < totalProjects; i++) {
          try {
            updateProgress(i + 1, totalProjects, `æ­£åœ¨ç”Ÿæˆé¡¹ç›® ${i + 1}`);
            
            // åˆ›å»ºé¡¹ç›®
            const projectTitle = `æµ‹è¯•é¡¹ç›® ${String(i + 1).padStart(3, '0')} - ${generateRandomPrompt(i)}`;
            const project = await storage.createProject(projectTitle);
            log(`âœ… é¡¹ç›® ${i + 1} å·²åˆ›å»º: ${project.title}`, 'success');
            
            // ç”Ÿæˆæ¶ˆæ¯æ•°é‡ï¼ˆ2-4æ¡ï¼‰
            const messageCount = 2 + Math.floor(Math.random() * 3);
            
            for (let j = 0; j < messageCount; j++) {
              // ç”¨æˆ·æ¶ˆæ¯
              const userMessage = j === 0 
                ? generateRandomPrompt(i)
                : `ç»§ç»­ä¼˜åŒ–ï¼Œæ·»åŠ æ›´å¤šç»†èŠ‚`;
              
              await storage.saveMessage(project.id, {
                role: 'user',
                content: userMessage,
                imageData: j === 0 && Math.random() > 0.5 ? imageData : null // 50% æ¦‚ç‡åœ¨ç¬¬ä¸€æ¡æ¶ˆæ¯ä¸­åŒ…å«å›¾ç‰‡
              });
              
              // AIå›å¤
              const aiResponse = j === messageCount - 1
                ? `å›¾ç‰‡å·²ç”Ÿæˆå®Œæˆï¼è¿™æ˜¯ä¸€å¹…ç²¾ç¾çš„ä½œå“ï¼Œå±•ç°äº†æ‚¨æ‰€æè¿°çš„åœºæ™¯ã€‚å¸Œæœ›æ‚¨å–œæ¬¢è¿™ä¸ªç»“æœã€‚`
                : generateRandomResponse(i);
              
              // æœ€åä¸€æ¡æ¶ˆæ¯åŒ…å«å›¾ç‰‡
              const hasImage = j === messageCount - 1;
              await storage.saveMessage(project.id, {
                role: 'assistant',
                content: aiResponse,
                imageData: hasImage ? imageData : null
              });
            }
            
            log(`âœ… é¡¹ç›® ${i + 1} å®Œæˆï¼ŒåŒ…å« ${messageCount * 2} æ¡æ¶ˆæ¯`, 'success');
            successCount++;
            
            // æ·»åŠ å°å»¶è¿Ÿï¼Œé¿å…é˜»å¡
            if (i % 10 === 0) {
              await new Promise(resolve => setTimeout(resolve, 100));
            }
          } catch (error) {
            log(`âŒ é¡¹ç›® ${i + 1} ç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
            errorCount++;
          }
        }
        
        // å®Œæˆ
        updateProgress(totalProjects, totalProjects, 'ç”Ÿæˆå®Œæˆ');
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        log(`âœ… æµ‹è¯•æ•°æ®ç”Ÿæˆå®Œæˆï¼`, 'success');
        log(`   æˆåŠŸ: ${successCount} ä¸ªé¡¹ç›®`, 'success');
        log(`   å¤±è´¥: ${errorCount} ä¸ªé¡¹ç›®`, errorCount > 0 ? 'error' : 'info');
        log('â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”', 'info');
        log('ğŸ’¡ æç¤ºï¼šç°åœ¨å¯ä»¥å‰å¾€é¡¹ç›®åº“æŸ¥çœ‹ç”Ÿæˆçš„æ•°æ®', 'info');
        
      } catch (error) {
        log(`âŒ ç”Ÿæˆå¤±è´¥: ${error.message}`, 'error');
        console.error('ç”Ÿæˆé”™è¯¯:', error);
      } finally {
        btn.disabled = false;
      }
    };

    // æ¸…ç©ºæ‰€æœ‰æ•°æ®
    window.clearAllData = async function() {
      if (!confirm('ç¡®å®šè¦æ¸…ç©ºæ‰€æœ‰å†å²æ•°æ®å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) {
        return;
      }
      
      const btn = document.getElementById('clearBtn');
      const logDiv = document.getElementById('log');
      
      try {
        btn.disabled = true;
        logDiv.innerHTML = '';
        log('ğŸ—‘ï¸ æ­£åœ¨æ¸…ç©ºæ‰€æœ‰æ•°æ®...', 'info');
        
        const storage = await loadStorageFunctions();
        await storage.clearAllHistory();
        
        log('âœ… æ‰€æœ‰æ•°æ®å·²æ¸…ç©º', 'success');
        log('ğŸ’¡ æç¤ºï¼šé¡µé¢å·²åˆ·æ–°ï¼Œå¯ä»¥é‡æ–°ç”Ÿæˆæµ‹è¯•æ•°æ®', 'info');
        
        setTimeout(() => {
          window.location.reload();
        }, 1000);
      } catch (error) {
        log(`âŒ æ¸…ç©ºå¤±è´¥: ${error.message}`, 'error');
        console.error('æ¸…ç©ºé”™è¯¯:', error);
      } finally {
        btn.disabled = false;
      }
    };

    // é¡µé¢åŠ è½½å®Œæˆæç¤º
    window.addEventListener('DOMContentLoaded', () => {
      console.log('âœ… æµ‹è¯•æ•°æ®ç”Ÿæˆè„šæœ¬å·²åŠ è½½');
      console.log('ğŸ’¡ ç‚¹å‡»"å¼€å§‹ç”Ÿæˆæµ‹è¯•æ•°æ®"æŒ‰é’®å¼€å§‹ç”Ÿæˆ');
      console.log('ğŸ’¡ è®¿é—®åœ°å€: http://localhost:3000/generate-test-data.html');
    });
  </script>
</body>
</html>
